<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrandForge Ultimate | Visual Site OS</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;600;800&family=Space+Grotesk:wght@500&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <style>
        /* --- SYSTEM UI VARIABLES --- */
        :root {
            --app-bg: #0f172a;
            --panel-bg: #1e293b;
            --border: #334155;
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            --accent: #22d3ee;
            --danger: #ef4444;
            --success: #10b981;
            --radius: 6px;
            --font-ui: 'Inter', system-ui, sans-serif;
        }

        /* --- GLOBAL RESET --- */
        * { box-sizing: border-box; outline: none; -webkit-font-smoothing: antialiased; }
        body { margin: 0; font-family: var(--font-ui); background: var(--app-bg); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }
        
        /* --- APP LAYOUT --- */
        .app-shell { display: flex; width: 100%; height: 100%; }
        
        /* SIDEBAR (Tools) */
        .sidebar { width: 60px; background: var(--panel-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; z-index: 50; flex-shrink: 0; }
        .nav-icon { width: 40px; height: 40px; border-radius: 8px; display: grid; place-items: center; font-size: 20px; color: var(--text-sub); cursor: pointer; transition: 0.2s; margin-bottom: 15px; position: relative; }
        .nav-icon:hover { color: white; background: rgba(255,255,255,0.05); }
        .nav-icon.active { background: var(--primary); color: white; }
        .nav-icon.active::after { content: ''; position: absolute; right: -10px; width: 3px; height: 20px; background: white; border-radius: 2px 0 0 2px; }

        /* LEFT PANEL (Context) */
        .panel-left { width: 280px; background: var(--panel-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; transition: 0.3s; flex-shrink: 0; }
        .panel-header { padding: 16px; border-bottom: 1px solid var(--border); font-weight: 600; font-family: 'Outfit', sans-serif; font-size: 1.1rem; display: flex; justify-content: space-between; align-items: center; }
        .panel-content { flex: 1; overflow-y: auto; padding: 15px; }

        /* CENTER CANVAS (Workspace) */
        .workspace { flex: 1; background: #0f172a; position: relative; display: flex; flex-direction: column; overflow: hidden; }
        .toolbar { height: 50px; border-bottom: 1px solid var(--border); background: var(--panel-bg); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; }
        
        /* The Website Canvas */
        .canvas-container { flex: 1; overflow-y: auto; padding: 40px; display: flex; justify-content: center; background: url('data:image/svg+xml;utf8,<svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><circle cx="1" cy="1" r="1" fill="rgba(255,255,255,0.05)"/></svg>'); }
        .artboard { 
            width: 100%; max-width: 1100px; min-height: 800px; background: white; color: #111; 
            box-shadow: 0 50px 100px -20px rgba(0,0,0,0.5); border-radius: 2px; transition: width 0.3s;
            position: relative;
        }
        /* Mobile/Tablet Views */
        .artboard.mobile { max-width: 375px; }
        .artboard.tablet { max-width: 768px; }

        /* RIGHT PANEL (Inspector) */
        .panel-right { width: 280px; background: var(--panel-bg); border-left: 1px solid var(--border); display: flex; flex-direction: column; flex-shrink: 0; }
        
        /* --- UI COMPONENTS --- */
        .btn { background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: var(--radius); font-size: 0.85rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
        .btn:hover { background: var(--primary-hover); }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-main); }
        .btn-outline:hover { background: rgba(255,255,255,0.05); border-color: var(--text-sub); }
        .btn-sm { padding: 4px 8px; font-size: 0.75rem; }
        
        .form-group { margin-bottom: 12px; }
        label { display: block; font-size: 0.75rem; color: var(--text-sub); margin-bottom: 4px; font-weight: 600; }
        input, select, textarea { 
            width: 100%; background: #0f172a; border: 1px solid var(--border); color: white; 
            padding: 8px; border-radius: 4px; font-size: 0.85rem; font-family: var(--font-ui); 
        }
        input:focus { border-color: var(--primary); }

        /* --- BUILDER ELEMENTS --- */
        /* These styles exist INSIDE the artboard */
        .artboard section { position: relative; border: 2px solid transparent; transition: 0.2s; }
        .artboard section:hover { border-color: rgba(99, 102, 241, 0.3); }
        .artboard section.selected { border-color: var(--primary); }
        
        /* Editing Overlays */
        .hover-actions { 
            position: absolute; top: -25px; right: 0; background: var(--primary); 
            color: white; border-radius: 4px 4px 0 0; display: none; padding: 2px 8px; font-size: 0.7rem; z-index: 10;
        }
        .artboard section:hover .hover-actions { display: flex; gap: 5px; }
        
        /* Text Editable */
        [contenteditable]:focus { outline: 2px solid var(--accent); border-radius: 2px; }

        /* --- CHART & BRANDING --- */
        .chart-container { width: 100%; height: 200px; position: relative; }
        .name-card { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 15px; border-radius: 6px; margin-bottom: 10px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .name-card:hover { border-color: var(--primary); background: rgba(99, 102, 241, 0.1); }
        .name-card.selected { border: 2px solid var(--primary); background: rgba(99, 102, 241, 0.2); }

        /* --- BLOCK PREVIEWS (Sidebar) --- */
        .block-preview { padding: 10px; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 8px; cursor: grab; background: rgba(255,255,255,0.02); display: flex; align-items: center; gap: 10px; font-size: 0.85rem; }
        .block-preview:hover { border-color: var(--primary); color: white; }

        /* Hide Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--app-bg); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
    </style>
</head>
<body>

<div class="app-shell">
    
    <aside class="sidebar">
        <div class="nav-icon" id="nav-home" onclick="UI.switchTab('home')" title="Project"><i class="ph ph-rocket"></i></div>
        <div class="nav-icon active" id="nav-builder" onclick="UI.switchTab('builder')" title="Website Builder"><i class="ph ph-desktop"></i></div>
        <div class="nav-icon" id="nav-brand" onclick="UI.switchTab('brand')" title="Branding Engine"><i class="ph ph-magic-wand"></i></div>
        <div class="nav-icon" id="nav-strategy" onclick="UI.switchTab('strategy')" title="Strategy Radar"><i class="ph ph-chart-polar"></i></div>
        <div style="flex:1"></div>
        <div class="nav-icon" onclick="Project.save()" title="Save Project"><i class="ph ph-floppy-disk"></i></div>
    </aside>

    <div class="panel-left" id="panel-left">
        </div>

    <div class="workspace">
        <div class="toolbar">
            <div style="display:flex; gap:10px; align-items:center;">
                <span id="project-name-display" style="font-weight:700;">Untitled Project</span>
                <span style="font-size:0.75rem; color:var(--text-sub); background:rgba(255,255,255,0.05); padding:2px 6px; border-radius:4px;">Draft</span>
            </div>
            <div style="display:flex; gap:5px;">
                <button class="nav-icon" style="margin:0; width:32px; height:32px;" onclick="Builder.setDevice('desktop')"><i class="ph ph-desktop"></i></button>
                <button class="nav-icon" style="margin:0; width:32px; height:32px;" onclick="Builder.setDevice('tablet')"><i class="ph ph-device-tablet"></i></button>
                <button class="nav-icon" style="margin:0; width:32px; height:32px;" onclick="Builder.setDevice('mobile')"><i class="ph ph-device-mobile"></i></button>
            </div>
            <div>
                <button class="btn btn-outline" onclick="Builder.exportHTML()"><i class="ph ph-export"></i> Export Code</button>
            </div>
        </div>

        <div class="canvas-container">
            <div id="artboard" class="artboard">
                </div>
        </div>
    </div>

    <div class="panel-right" id="inspector-panel">
        <div class="panel-header">
            <span>Inspector</span>
            <span style="font-size:0.7rem; color:var(--text-sub);">Select Element</span>
        </div>
        <div class="panel-content" id="inspector-content">
            <p style="text-align:center; color:var(--text-sub); margin-top:20px;">Click any element on the website canvas to edit its styles.</p>
        </div>
    </div>

</div>

<script>
    /* --- DATA STORE --- */
    const State = {
        meta: {
            industry: 'tech',
            name: 'BrandZero',
            desc: 'The best startup in the world.'
        },
        competitors: [
            { name: "Competitor A", price: 8, quality: 5, brand: 6 },
            { name: "Competitor B", price: 4, quality: 9, brand: 8 }
        ],
        // The Website Blocks
        website: [
            {
                id: 'hero-1',
                type: 'hero',
                styles: { background: '#ffffff', padding: '80px 20px', textAlign: 'center' },
                content: { h1: 'Build Your Dream.', p: 'Edit this text directly. Click any element to style it.', btn: 'Get Started' },
                elementStyles: {
                    h1: { fontSize: '3.5rem', color: '#111827', marginBottom: '20px' },
                    p: { fontSize: '1.2rem', color: '#4b5563', marginBottom: '30px' },
                    btn: { background: '#6366f1', color: '#ffffff', padding: '12px 30px', borderRadius: '6px' }
                }
            },
            {
                id: 'features-1',
                type: 'features',
                styles: { background: '#f8fafc', padding: '60px 20px' },
                content: { title: 'Why Choose Us', items: ['Speed', 'Security', 'Scale'] },
                elementStyles: {
                    title: { fontSize: '2.5rem', color: '#1e293b', textAlign: 'center', marginBottom: '40px' }
                }
            }
        ]
    };

    /* --- UI CONTROLLER --- */
    const UI = {
        activeTab: 'builder',

        init: () => {
            UI.renderLeftPanel();
            Builder.render();
            // Auto-load
            if(localStorage.getItem('brandForgePro')) {
                const saved = JSON.parse(localStorage.getItem('brandForgePro'));
                Object.assign(State, saved);
                document.getElementById('project-name-display').innerText = State.meta.name;
                Builder.render();
            }
        },

        switchTab: (tab) => {
            UI.activeTab = tab;
            document.querySelectorAll('.nav-icon').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-'+tab).classList.add('active');
            UI.renderLeftPanel();
        },

        renderLeftPanel: () => {
            const container = document.getElementById('panel-left');
            container.innerHTML = '';

            // 1. HOME / PROFILE
            if (UI.activeTab === 'home') {
                container.innerHTML = `
                    <div class="panel-header">Project Settings</div>
                    <div class="panel-content">
                        <div class="form-group">
                            <label>Industry</label>
                            <select id="set-ind" onchange="State.meta.industry=this.value">
                                <option value="tech">SaaS / Technology</option>
                                <option value="food">Food & Beverage</option>
                                <option value="fashion">Fashion & Retail</option>
                                <option value="agency">Agency / Service</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Brand Name</label>
                            <input type="text" value="${State.meta.name}" oninput="State.meta.name=this.value; document.getElementById('project-name-display').innerText=this.value">
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea rows="4" oninput="State.meta.desc=this.value">${State.meta.desc}</textarea>
                        </div>
                    </div>
                `;
                document.getElementById('set-ind').value = State.meta.industry;
            }

            // 2. BUILDER (Block Library)
            if (UI.activeTab === 'builder') {
                container.innerHTML = `
                    <div class="panel-header">Add Blocks</div>
                    <div class="panel-content">
                        <div class="block-preview" onclick="Builder.addBlock('hero')"><i class="ph ph-image-square"></i> Hero Section</div>
                        <div class="block-preview" onclick="Builder.addBlock('features')"><i class="ph ph-squares-four"></i> Feature Grid</div>
                        <div class="block-preview" onclick="Builder.addBlock('text')"><i class="ph ph-text-t"></i> Rich Text</div>
                        <div class="block-preview" onclick="Builder.addBlock('cta')"><i class="ph ph-megaphone"></i> Call to Action</div>
                        <div class="block-preview" onclick="Builder.addBlock('gallery')"><i class="ph ph-images"></i> Image Gallery</div>
                        <div class="block-preview" onclick="Builder.addBlock('footer')"><i class="ph ph-layout"></i> Simple Footer</div>
                        
                        <hr style="border:0; border-top:1px solid var(--border); margin:15px 0;">
                        <div style="font-size:0.75rem; color:var(--text-sub); margin-bottom:10px; font-weight:600;">Structure</div>
                        <div id="layer-list"></div>
                    </div>
                `;
                Builder.renderLayerList();
            }

            // 3. BRANDING ENGINE
            if (UI.activeTab === 'brand') {
                container.innerHTML = `
                    <div class="panel-header">Brand Engine</div>
                    <div class="panel-content">
                        <button class="btn" style="width:100%" onclick="Branding.generate()">Generate Names</button>
                        <div id="brand-results" style="margin-top:15px;"></div>
                    </div>
                `;
            }

            // 4. STRATEGY
            if (UI.activeTab === 'strategy') {
                container.innerHTML = `
                    <div class="panel-header">Market Radar</div>
                    <div class="panel-content">
                        <div id="radar-chart-area" style="width:240px; height:240px; margin:0 auto;"></div>
                        <div style="margin-top:20px;">
                            <div class="form-group"><label>My Price (1-10)</label><input type="number" id="strat-price" value="5"></div>
                            <div class="form-group"><label>My Quality (1-10)</label><input type="number" id="strat-qual" value="8"></div>
                            <div class="form-group"><label>My Brand (1-10)</label><input type="number" id="strat-brand" value="6"></div>
                            <button class="btn btn-outline" style="width:100%" onclick="Strategy.render()">Update Radar</button>
                        </div>
                    </div>
                `;
                setTimeout(Strategy.render, 100);
            }
        }
    };

    /* --- WEBSITE BUILDER ENGINE (The Core) --- */
    const Builder = {
        selectedId: null, // Block ID
        selectedEl: null, // specific DOM element (h1, p) inside block

        render: () => {
            const board = document.getElementById('artboard');
            board.innerHTML = '';
            
            State.website.forEach((block, index) => {
                const section = document.createElement('section');
                section.id = block.id;
                section.dataset.type = block.type;
                
                // Apply Section Styles
                Object.assign(section.style, block.styles);
                
                // Hover Controls (Move Up/Down/Delete)
                const controls = document.createElement('div');
                controls.className = 'hover-actions';
                controls.innerHTML = `
                    <span style="cursor:pointer" onclick="Builder.moveBlock(${index}, -1)">↑</span>
                    <span style="cursor:pointer" onclick="Builder.moveBlock(${index}, 1)">↓</span>
                    <span style="cursor:pointer" onclick="Builder.deleteBlock('${block.id}')">×</span>
                `;
                section.appendChild(controls);

                // Render Content based on Type
                let html = '';
                const s = block.elementStyles || {};
                
                // Helper to inject inline styles
                const st = (key) => Object.entries(s[key]||{}).map(([k,v]) => `${k.replace(/[A-Z]/g, m => "-"+m.toLowerCase())}:${v}`).join(';');

                if(block.type === 'hero') {
                    html = `
                        <h1 contenteditable="true" data-key="h1" style="${st('h1')}">${block.content.h1}</h1>
                        <p contenteditable="true" data-key="p" style="${st('p')}">${block.content.p}</p>
                        <button contenteditable="true" data-key="btn" style="${st('btn')}">${block.content.btn}</button>
                    `;
                } else if(block.type === 'features') {
                    html = `
                        <h2 contenteditable="true" data-key="title" style="${st('title')}">${block.content.title}</h2>
                        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; text-align:left;">
                            ${block.content.items.map(item => `
                                <div style="background:white; padding:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
                                    <h3 contenteditable="true" style="color:#333; margin-bottom:10px;">${item}</h3>
                                    <p contenteditable="true" style="color:#666; font-size:0.9rem;">Edit this feature description.</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else if(block.type === 'text') {
                    html = `<div contenteditable="true" data-key="text" style="${st('text')}">${block.content.text}</div>`;
                } else if(block.type === 'cta') {
                    html = `
                        <h2 contenteditable="true" data-key="h2" style="${st('h2')}">${block.content.h2}</h2>
                        <button contenteditable="true" data-key="btn" style="${st('btn')}">${block.content.btn}</button>
                    `;
                } else if(block.type === 'gallery') {
                     html = `
                        <h2 contenteditable="true" style="text-align:center; margin-bottom:30px;">${block.content.title}</h2>
                        <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px;">
                            <div style="height:150px; background:#eee; display:grid; place-items:center; color:#999;">Image 1</div>
                            <div style="height:150px; background:#eee; display:grid; place-items:center; color:#999;">Image 2</div>
                            <div style="height:150px; background:#eee; display:grid; place-items:center; color:#999;">Image 3</div>
                        </div>
                     `;
                } else if(block.type === 'footer') {
                    html = `<div contenteditable="true" style="text-align:center; opacity:0.7;">&copy; 2026 ${State.meta.name}. All rights reserved.</div>`;
                }

                // Append HTML
                const contentWrapper = document.createElement('div');
                contentWrapper.innerHTML = html;
                
                // Event Delegation for Selection
                section.addEventListener('click', (e) => {
                    e.stopPropagation(); // prevent bubbling
                    Builder.selectBlock(block.id);
                    // If clicked a child element
                    if(e.target.dataset.key || e.target.tagName === 'BUTTON' || e.target.tagName.startsWith('H')) {
                        Builder.selectElement(block.id, e.target);
                    }
                });
                
                // Sync Content Updates (onInput)
                contentWrapper.addEventListener('input', (e) => {
                    const key = e.target.dataset.key;
                    if(key) block.content[key] = e.target.innerText;
                });

                section.appendChild(contentWrapper);
                board.appendChild(section);
            });
        },

        addBlock: (type) => {
            const id = type + '-' + Date.now();
            let block = { id, type, styles: { padding: '60px 20px' }, content: {}, elementStyles: {} };
            
            // Defaults
            if(type === 'text') {
                block.content = { text: "Start writing your content here..." };
                block.elementStyles = { text: { fontSize: '1.1rem', lineHeight: '1.6', maxWidth: '800px', margin: '0 auto' }};
            }
            if(type === 'cta') {
                block.styles = { background: '#111827', color: 'white', textAlign: 'center' };
                block.content = { h2: "Ready to Start?", btn: "Join Now" };
                block.elementStyles = { h2: { marginBottom: '20px' }, btn: { background: 'white', color: 'black', padding: '10px 25px', borderRadius: '4px' }};
            }
            if(type === 'gallery') {
                block.content = { title: "Our Work" };
            }
            if(type === 'footer') {
                block.styles = { background: '#1e293b', color: 'white', padding: '30px' };
            }

            State.website.push(block);
            Builder.render();
            if(UI.activeTab === 'builder') Builder.renderLayerList();
        },

        deleteBlock: (id) => {
            State.website = State.website.filter(b => b.id !== id);
            Builder.render();
            Builder.renderLayerList();
        },

        moveBlock: (idx, dir) => {
            if (dir === -1 && idx > 0) {
                [State.website[idx], State.website[idx-1]] = [State.website[idx-1], State.website[idx]];
            } else if (dir === 1 && idx < State.website.length - 1) {
                [State.website[idx], State.website[idx+1]] = [State.website[idx+1], State.website[idx]];
            }
            Builder.render();
            Builder.renderLayerList();
        },

        setDevice: (mode) => {
            const b = document.getElementById('artboard');
            b.className = 'artboard ' + mode;
        },

        renderLayerList: () => {
            const list = document.getElementById('layer-list');
            if(!list) return;
            list.innerHTML = State.website.map((b, i) => `
                <div style="padding:8px; border-bottom:1px solid #334155; font-size:0.8rem; display:flex; justify-content:space-between; cursor:pointer; background:${Builder.selectedId === b.id ? 'rgba(99,102,241,0.2)' : 'transparent'}" onclick="Builder.selectBlock('${b.id}')">
                    <span>${i+1}. ${b.type.toUpperCase()}</span>
                </div>
            `).join('');
        },

        // --- SELECTION & INSPECTOR ---
        selectBlock: (id) => {
            Builder.selectedId = id;
            Builder.selectedEl = null; // reset specific element selection
            
            // Highlight in Canvas
            document.querySelectorAll('.artboard section').forEach(s => s.classList.remove('selected'));
            document.getElementById(id).classList.add('selected');
            
            // Show Section Settings in Inspector
            const block = State.website.find(b => b.id === id);
            const panel = document.getElementById('inspector-content');
            
            panel.innerHTML = `
                <div class="form-group">
                    <label>Background Color</label>
                    <input type="color" value="${block.styles.background || '#ffffff'}" oninput="Builder.updateStyle('${id}', 'section', 'background', this.value)">
                </div>
                <div class="form-group">
                    <label>Text Color</label>
                    <input type="color" value="${block.styles.color || '#000000'}" oninput="Builder.updateStyle('${id}', 'section', 'color', this.value)">
                </div>
                <div class="form-group">
                    <label>Padding (Vertical)</label>
                    <input type="text" value="${block.styles.padding?.split(' ')[0] || '60px'}" onchange="Builder.updateStyle('${id}', 'section', 'padding', this.value + ' 20px')">
                </div>
                <div class="form-group">
                    <label>Text Align</label>
                    <select onchange="Builder.updateStyle('${id}', 'section', 'textAlign', this.value)">
                        <option value="left">Left</option>
                        <option value="center" ${block.styles.textAlign === 'center' ? 'selected' : ''}>Center</option>
                        <option value="right">Right</option>
                    </select>
                </div>
            `;
            
            if(UI.activeTab === 'builder') Builder.renderLayerList();
        },

        selectElement: (blockId, domEl) => {
            Builder.selectedEl = domEl;
            const key = domEl.dataset.key; // e.g., 'h1', 'btn'
            if(!key) return;

            const block = State.website.find(b => b.id === blockId);
            const styles = block.elementStyles[key] || {};

            const panel = document.getElementById('inspector-content');
            
            // Render specific element controls
            panel.innerHTML = `
                <div style="background:var(--app-bg); padding:10px; margin-bottom:15px; border-radius:4px; border:1px solid var(--primary);">
                    Editing: <strong>${domEl.tagName}</strong> inside ${block.type}
                </div>
                <div class="form-group">
                    <label>Font Size</label>
                    <input type="text" value="${styles.fontSize || ''}" onchange="Builder.updateStyle('${blockId}', '${key}', 'fontSize', this.value)">
                </div>
                <div class="form-group">
                    <label>Color</label>
                    <input type="color" value="${styles.color || '#000000'}" oninput="Builder.updateStyle('${blockId}', '${key}', 'color', this.value)">
                </div>
                <div class="form-group">
                    <label>Margin Bottom</label>
                    <input type="text" value="${styles.marginBottom || '0px'}" onchange="Builder.updateStyle('${blockId}', '${key}', 'marginBottom', this.value)">
                </div>
                ${ key === 'btn' ? `
                <div class="form-group">
                    <label>Background</label>
                    <input type="color" value="${styles.background || '#6366f1'}" oninput="Builder.updateStyle('${blockId}', '${key}', 'background', this.value)">
                </div>
                <div class="form-group">
                    <label>Border Radius</label>
                    <input type="text" value="${styles.borderRadius || '4px'}" onchange="Builder.updateStyle('${blockId}', '${key}', 'borderRadius', this.value)">
                </div>` : ''}
            `;
        },

        updateStyle: (blockId, elementKey, cssProp, value) => {
            const block = State.website.find(b => b.id === blockId);
            if(elementKey === 'section') {
                block.styles[cssProp] = value;
                document.getElementById(blockId).style[cssProp] = value;
            } else {
                if(!block.elementStyles[elementKey]) block.elementStyles[elementKey] = {};
                block.elementStyles[elementKey][cssProp] = value;
                // find the dom element and update
                const el = document.querySelector(`#${blockId} [data-key="${elementKey}"]`);
                if(el) el.style[cssProp] = value;
            }
        },

        exportHTML: () => {
            let html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>${State.meta.name}</title><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet"><style>body{margin:0;font-family:'Inter',sans-serif;color:#333} *{box-sizing:border-box} section{position:relative;}</style></head><body>`;
            
            // Use the current DOM state, but strip contenteditable and utility classes
            const clone = document.getElementById('artboard').cloneNode(true);
            clone.querySelectorAll('.hover-actions').forEach(e => e.remove());
            clone.querySelectorAll('*').forEach(e => {
                e.removeAttribute('contenteditable');
                e.removeAttribute('data-key');
                e.classList.remove('selected');
                e.style.border = 'none'; // remove selection borders
            });

            html += clone.innerHTML;
            html += `</body></html>`;

            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = State.meta.name.replace(/\s/g, '-') + '.html';
            a.click();
        }
    };

    /* --- BRANDING ENGINE (Linguistic) --- */
    const Branding = {
        roots: {
            tech: ['Sys', 'Net', 'Nov', 'Vel', 'Aero', 'Lumi', 'Quant', 'Syn', 'Dat', 'Virt'],
            nature: ['Flor', 'Terr', 'Viv', 'Sol', 'Aer', 'Mar', 'Luc', 'Bio', 'Eco'],
            power: ['Rex', 'Max', 'Fort', 'Dyn', 'Opt', 'Prim', 'Ult', 'Mag']
        },
        suffixes: ['ify', 'os', 'ix', 'ex', 'io', 'on', 'ra', 'gen', 'flow'],
        
        generate: () => {
            const container = document.getElementById('brand-results');
            container.innerHTML = '';
            
            const ind = State.meta.industry;
            const category = (ind === 'tech' || ind === 'agency') ? 'tech' : (ind === 'food' ? 'nature' : 'power');
            const roots = Branding.roots[category] || Branding.roots.tech;
            
            let names = [];
            
            // 1. Root + Suffix
            for(let i=0; i<6; i++) {
                const r = roots[Math.floor(Math.random()*roots.length)];
                const s = Branding.suffixes[Math.floor(Math.random()*Branding.suffixes.length)];
                names.push(r + s);
            }
            
            // 2. Compound
            names.push(State.meta.name + 'Box');
            names.push('Go' + State.meta.name);
            
            names.forEach(n => {
                const div = document.createElement('div');
                div.className = 'name-card';
                div.innerHTML = `<strong>${n}</strong> <span style="font-size:0.75rem; color:#aaa;">${n.toLowerCase()}.com</span>`;
                div.onclick = () => {
                    State.meta.name = n;
                    document.getElementById('project-name-display').innerText = n;
                    alert('Brand Name Updated!');
                };
                container.appendChild(div);
            });
        }
    };

    /* --- STRATEGY ENGINE (Radar Chart) --- */
    const Strategy = {
        render: () => {
            const price = parseInt(document.getElementById('strat-price')?.value || 5);
            const qual = parseInt(document.getElementById('strat-qual')?.value || 8);
            const brand = parseInt(document.getElementById('strat-brand')?.value || 6);

            // Simple SVG Triangle Drawing
            const max = 10;
            // Coordinates: Top (Quality), Right (Price), Left (Brand)
            // Center is 100,100. Radius 100.
            
            const pY = 100 - (qual/max)*90; // Top
            const pX = 100;
            
            // Bottom Right (Price) approx 30 deg
            const brX = 100 + (price/max)*80;
            const brY = 100 + (price/max)*50;
            
            // Bottom Left (Brand)
            const blX = 100 - (brand/max)*80;
            const blY = 100 + (brand/max)*50;

            const svg = `
                <svg width="240" height="240" viewBox="0 0 200 200" style="background:#111; border-radius:50%;">
                    <circle cx="100" cy="100" r="90" fill="none" stroke="#333"/>
                    <circle cx="100" cy="100" r="60" fill="none" stroke="#333"/>
                    <circle cx="100" cy="100" r="30" fill="none" stroke="#333"/>
                    <line x1="100" y1="10" x2="100" y2="190" stroke="#333"/>
                    <line x1="20" y1="150" x2="180" y2="50" stroke="#333" style="display:none"/> 
                    
                    <polygon points="${pX},${pY} ${brX},${brY} ${blX},${blY}" fill="rgba(99, 102, 241, 0.5)" stroke="#6366f1" stroke-width="2"/>
                    
                    <text x="100" y="20" fill="white" font-size="10" text-anchor="middle">Quality</text>
                    <text x="170" y="150" fill="white" font-size="10" text-anchor="middle">Price</text>
                    <text x="30" y="150" fill="white" font-size="10" text-anchor="middle">Brand</text>
                </svg>
            `;
            
            const area = document.getElementById('radar-chart-area');
            if(area) area.innerHTML = svg;
        }
    };

    const Project = {
        save: () => {
            localStorage.setItem('brandForgePro', JSON.stringify(State));
            alert('Project Saved Locally!');
        }
    };

    // Boot
    window.onload = UI.init;

</script>
</body>
</html>
